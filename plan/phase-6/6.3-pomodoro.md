# 6.3 Pomodoro Timer

**Objective:** Integrated Pomodoro technique with automatic blocking/unblocking.

## Implementation

### Pomodoro Timer

Create `Models/PomodoroTimer.swift`:

```swift
import Foundation
import Combine

class PomodoroTimer: ObservableObject {
    @Published var isRunning = false
    @Published var isWorkSession = true
    @Published var remainingTime: TimeInterval = 1500 // 25 minutes

    private var timer: Timer?

    let workDuration: TimeInterval = 1500 // 25 min
    let shortBreakDuration: TimeInterval = 300 // 5 min
    let longBreakDuration: TimeInterval = 900 // 15 min

    var sessionsCompleted = 0

    func start() {
        isRunning = true

        if isWorkSession {
            // Start blocking
            BlockListManager.shared.isBlocking = true
        }

        timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { [weak self] _ in
            self?.tick()
        }
    }

    func pause() {
        isRunning = false
        timer?.invalidate()
    }

    func reset() {
        pause()
        remainingTime = workDuration
        isWorkSession = true
    }

    private func tick() {
        remainingTime -= 1

        if remainingTime <= 0 {
            completeSession()
        }
    }

    private func completeSession() {
        timer?.invalidate()
        isRunning = false

        if isWorkSession {
            sessionsCompleted += 1

            // Stop blocking
            BlockListManager.shared.isBlocking = false

            // Start break
            isWorkSession = false
            remainingTime = (sessionsCompleted % 4 == 0) ? longBreakDuration : shortBreakDuration

            NotificationHelper.shared.showPomodoroBreak()
        } else {
            // Start work session
            isWorkSession = true
            remainingTime = workDuration

            NotificationHelper.shared.showPomodoroWork()
        }
    }
}
```

### Pomodoro UI

Create `Views/PomodoroView.swift`:

```swift
import SwiftUI

struct PomodoroView: View {
    @StateObject private var timer = PomodoroTimer()

    var body: some View {
        VStack(spacing: 30) {
            Text(timer.isWorkSession ? "Work" : "Break")
                .font(.title)

            ZStack {
                Circle()
                    .stroke(Color.gray.opacity(0.2), lineWidth: 20)
                    .frame(width: 200, height: 200)

                Circle()
                    .trim(from: 0, to: CGFloat(timer.remainingTime / (timer.isWorkSession ? timer.workDuration : timer.shortBreakDuration)))
                    .stroke(timer.isWorkSession ? Color.red : Color.green, lineWidth: 20)
                    .frame(width: 200, height: 200)
                    .rotationEffect(.degrees(-90))

                Text(formatTime(timer.remainingTime))
                    .font(.system(size: 40, weight: .bold, design: .monospaced))
            }

            HStack {
                Button(timer.isRunning ? "Pause" : "Start") {
                    if timer.isRunning {
                        timer.pause()
                    } else {
                        timer.start()
                    }
                }
                .buttonStyle(.borderedProminent)

                Button("Reset") {
                    timer.reset()
                }
                .buttonStyle(.bordered)
            }

            Text("Sessions: \\(timer.sessionsCompleted)")
                .font(.caption)
        }
        .padding()
    }

    func formatTime(_ seconds: TimeInterval) -> String {
        let mins = Int(seconds) / 60
        let secs = Int(seconds) % 60
        return String(format: "%02d:%02d", mins, secs)
    }
}
```

## Testing

✅ Timer counts down
✅ Auto-starts blocking on work
✅ Auto-stops on break
✅ Notifications work

## Estimated Time

**2-3 hours**
