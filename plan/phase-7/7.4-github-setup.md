# 7.4 GitHub Setup & CI/CD

**Objective:** Configure GitHub repository with releases, CI/CD, and automated workflows.

## Implementation

### Step 1: Repository Structure

```
FocusDragon/
├── .github/
│   ├── workflows/
│   │   ├── build.yml
│   │   ├── test.yml
│   │   └── release.yml
│   ├── ISSUE_TEMPLATE/
│   │   ├── bug_report.md
│   │   └── feature_request.md
│   └── pull_request_template.md
├── FocusDragon/
├── FocusDragonDaemon/
├── Extensions/
├── docs/
├── .gitignore
├── LICENSE
├── README.md
├── CONTRIBUTING.md
└── CHANGELOG.md
```

### Step 2: GitHub Actions - Build Workflow

Create `.github/workflows/build.yml`:

```yaml
name: Build

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_14.3.app

      - name: Build
        run: |
          xcodebuild clean build \\
            -project FocusDragon.xcodeproj \\
            -scheme FocusDragon \\
            -configuration Debug \\
            CODE_SIGN_IDENTITY="" \\
            CODE_SIGNING_REQUIRED=NO

      - name: Run Tests
        run: |
          xcodebuild test \\
            -project FocusDragon.xcodeproj \\
            -scheme FocusDragon \\
            -destination 'platform=macOS'

      - name: Upload Build Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: FocusDragon-Debug
          path: build/Debug/FocusDragon.app
```

### Step 3: Release Workflow

Create `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    tags:
      - "v*"

jobs:
  release:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3

      - name: Select Xcode
        run: sudo xcode-select -s /Applications/Xcode_14.3.app

      - name: Import Certificates
        env:
          CERTIFICATE_BASE64: ${{ secrets.CERTIFICATE_BASE64 }}
          CERTIFICATE_PASSWORD: ${{ secrets.CERTIFICATE_PASSWORD }}
        run: |
          echo $CERTIFICATE_BASE64 | base64 --decode > certificate.p12
          security create-keychain -p actions build.keychain
          security default-keychain -s build.keychain
          security unlock-keychain -p actions build.keychain
          security import certificate.p12 -k build.keychain -P $CERTIFICATE_PASSWORD -T /usr/bin/codesign
          security set-key-partition-list -S apple-tool:,apple:,codesign: -s -k actions build.keychain

      - name: Build Release
        run: ./build-release.sh

      - name: Create DMG
        run: ./create-dmg.sh

      - name: Notarize
        env:
          APPLE_ID: ${{ secrets.APPLE_ID }}
          APPLE_PASSWORD: ${{ secrets.APPLE_PASSWORD }}
          TEAM_ID: ${{ secrets.TEAM_ID }}
        run: ./notarize.sh

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            build/FocusDragon-*.dmg
          body: |
            ## What's Changed
            See [CHANGELOG.md](CHANGELOG.md) for details.

            ## Installation
            1. Download FocusDragon-X.X.X.dmg
            2. Open and drag to Applications
            3. Launch and grant permissions

            ## Requirements
            - macOS 11.0+
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Step 4: Issue Templates

Create `.github/ISSUE_TEMPLATE/bug_report.md`:

```markdown
---
name: Bug Report
about: Report a bug or issue
title: "[BUG] "
labels: bug
assignees: ""
---

## Describe the Bug

A clear description of the bug.

## To Reproduce

Steps to reproduce:

1. Go to '...'
2. Click on '...'
3. See error

## Expected Behavior

What you expected to happen.

## Screenshots

If applicable, add screenshots.

## Environment

- macOS version:
- FocusDragon version:
- Browser (if applicable):

## Additional Context

Any other context about the problem.
```

### Step 5: CHANGELOG.md

```markdown
# Changelog

All notable changes to FocusDragon will be documented here.

## [1.0.0] - 2024-XX-XX

### Added

- Initial release
- Website blocking via /etc/hosts
- Application blocking via process monitoring
- Timer lock mechanism
- Random text lock mechanism
- Schedule lock mechanism
- Restart lock mechanism
- Chrome extension
- Firefox extension
- Safari extension
- Statistics tracking
- Pomodoro timer
- Menu bar mode

### Security

- Hardened runtime enabled
- Code signing with Developer ID
- Notarization by Apple
```

### Step 6: .gitignore

```
# Xcode
build/
*.pbxuser
*.mode1v3
*.mode2v3
*.perspectivev3
*.xcuserstate
xcuserdata/
*.xccheckout
*.moved-aside
DerivedData/
*.hmap
*.ipa

# Swift
*.swiftmodule
.build/

# Secrets
*.p12
*.mobileprovision
secrets/

# macOS
.DS_Store
.AppleDouble
.LSOverride

# Temporary
*.dmg
*.zip
tmp/
```

### Step 7: Release Process

**Manual release steps:**

1. Update version in Xcode
2. Update CHANGELOG.md
3. Commit changes
4. Create and push tag:

```bash
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0
```

5. GitHub Actions builds and creates release
6. Verify DMG downloads and installs
7. Update website with new version

## Testing

✅ Build workflow runs on PR
✅ Release workflow triggers on tag
✅ DMG created and notarized
✅ GitHub release published
✅ Download links work

## Deliverables

✅ GitHub repository structure
✅ CI/CD workflows
✅ Issue templates
✅ Release automation
✅ Documentation
✅ CHANGELOG

## Security Considerations

1. **Secrets management** - Use GitHub Secrets
2. **Certificate protection** - Never commit certs
3. **Code signing** - Automated in CI
4. **Notarization** - Automated in release

## Success Criteria

- Push to main triggers build
- Tag triggers release
- DMG automatically created
- Notarization successful
- Release published with assets

## Estimated Time

**3-4 hours**

---

## Phase 7 Complete!

All distribution and documentation tasks complete. FocusDragon is ready for public release.
